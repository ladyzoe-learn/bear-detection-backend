# å°ç£é»‘ç†Šæª¢æ¸¬ç³»çµ± - å¾Œç«¯API

é€™æ˜¯ä¸€å€‹åŸºæ–¼YOLOæ¨¡å‹çš„å°ç£é»‘ç†Šæª¢æ¸¬ç³»çµ±å¾Œç«¯APIæœå‹™ï¼Œæä¾›åœ–ç‰‡ä¸Šå‚³ã€æª¢æ¸¬åˆ†æå’Œçµæœç®¡ç†åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹è‰²

- ğŸ» **YOLOæ¨¡å‹æ•´åˆ**: æ”¯æ´è‡ªå®šç¾©è¨“ç·´çš„best.ptæ¨¡å‹æˆ–é è¨­YOLOv8æ¨¡å‹
- ğŸ“¸ **åœ–ç‰‡æª¢æ¸¬**: ä¸Šå‚³åœ–ç‰‡é€²è¡Œå°ç£é»‘ç†Šæª¢æ¸¬åˆ†æ
- ğŸ“Š **çµ±è¨ˆè³‡æ–™**: æä¾›æª¢æ¸¬çµ±è¨ˆå’Œæ­·å²è¨˜éŒ„
- ğŸŒ **RESTful API**: å®Œæ•´çš„REST APIæ¥å£
- ğŸ’¾ **æ•¸æ“šæŒä¹…åŒ–**: SQLiteæ•¸æ“šåº«å­˜å„²æª¢æ¸¬è¨˜éŒ„
- ğŸ”§ **CORSæ”¯æ´**: æ”¯æ´è·¨åŸŸè«‹æ±‚ï¼Œå¯èˆ‡å‰ç«¯æ‡‰ç”¨æ•´åˆ

## æŠ€è¡“æ¶æ§‹

- **å¾Œç«¯æ¡†æ¶**: Flask
- **AIæ¨¡å‹**: YOLO (Ultralytics)
- **æ•¸æ“šåº«**: SQLite
- **åœ–åƒè™•ç†**: OpenCV, PIL
- **éƒ¨ç½²**: æ”¯æ´æœ¬åœ°é–‹ç™¼å’Œé›²ç«¯éƒ¨ç½²

## APIç«¯é»

### å¥åº·æª¢æŸ¥
```
GET /api/health
```

### çµ±è¨ˆè³‡æ–™
```
GET /api/statistics
```

### åœ–ç‰‡æª¢æ¸¬
```
POST /api/detect
Content-Type: multipart/form-data

åƒæ•¸:
- image: åœ–ç‰‡æª”æ¡ˆ
- camera_id: ç›¸æ©ŸID (å¯é¸)
- location: ä½ç½®è³‡è¨Š (å¯é¸)
```

### æœ€è¿‘æª¢æ¸¬è¨˜éŒ„
```
GET /api/recent-detections?limit=10
```

### æ¨¡å‹è³‡è¨Š
```
GET /api/model-info
```

### è¨­å®šä¿¡å¿ƒåº¦é–¾å€¼
```
POST /api/set-confidence
Content-Type: application/json

{
  "threshold": 0.5
}
```

### æª”æ¡ˆå­˜å–
```
GET /api/uploads/{filename}
```

## å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒéœ€æ±‚

- Python 3.11+
- pip
- è™›æ“¬ç’°å¢ƒ (å»ºè­°)

### 2. å®‰è£ä¾è³´

```bash
# å‰µå»ºè™›æ“¬ç’°å¢ƒ
python -m venv venv

# å•Ÿå‹•è™›æ“¬ç’°å¢ƒ
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# å®‰è£ä¾è³´
pip install -r requirements.txt
```

### 3. æ¨¡å‹è¨­ç½®

å°‡æ‚¨è¨“ç·´å¥½çš„YOLOæ¨¡å‹æª”æ¡ˆ `best.pt` æ”¾ç½®åœ¨ä»¥ä¸‹ä»»ä¸€ä½ç½®ï¼š
- `/models/best.pt`
- `/best.pt`
- å°ˆæ¡ˆæ ¹ç›®éŒ„

å¦‚æœæ²’æœ‰è‡ªå®šç¾©æ¨¡å‹ï¼Œç³»çµ±æœƒè‡ªå‹•ä¸‹è¼‰ä¸¦ä½¿ç”¨é è¨­çš„YOLOv8æ¨¡å‹ã€‚

### 4. å•Ÿå‹•æœå‹™

```bash
python src/main.py
```

æœå‹™å°‡åœ¨ `http://localhost:5000` å•Ÿå‹•ã€‚

## å°ˆæ¡ˆçµæ§‹

```
bear-detection-backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user.py          # ç”¨æˆ¶æ¨¡å‹
â”‚   â”‚   â””â”€â”€ detection.py     # æª¢æ¸¬è¨˜éŒ„æ¨¡å‹
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ user.py          # ç”¨æˆ¶è·¯ç”±
â”‚   â”‚   â””â”€â”€ detection.py     # æª¢æ¸¬APIè·¯ç”±
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ bear_detection.py # YOLOæª¢æ¸¬æœå‹™
â”‚   â”œâ”€â”€ static/
â”‚   â”‚   â””â”€â”€ uploads/         # ä¸Šå‚³æª”æ¡ˆç›®éŒ„
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â””â”€â”€ app.db          # SQLiteæ•¸æ“šåº«
â”‚   â””â”€â”€ main.py             # ä¸»ç¨‹å¼å…¥å£
â”œâ”€â”€ models/
â”‚   â””â”€â”€ best.pt             # YOLOæ¨¡å‹æª”æ¡ˆ (éœ€è¦ç”¨æˆ¶æä¾›)
â”œâ”€â”€ venv/                   # è™›æ“¬ç’°å¢ƒ
â”œâ”€â”€ requirements.txt        # Pythonä¾è³´
â””â”€â”€ README.md              # å°ˆæ¡ˆèªªæ˜
```

## éƒ¨ç½²æŒ‡å—

### æœ¬åœ°é–‹ç™¼

1. æŒ‰ç…§ã€Œå¿«é€Ÿé–‹å§‹ã€æ­¥é©Ÿè¨­ç½®ç’°å¢ƒ
2. å•Ÿå‹•é–‹ç™¼æœå‹™å™¨ï¼š`python src/main.py`
3. APIå°‡åœ¨ `http://localhost:5000` å¯ç”¨

### é›²ç«¯éƒ¨ç½²

#### Render.com éƒ¨ç½²

1. å°‡å°ˆæ¡ˆæ¨é€åˆ°GitHub
2. åœ¨Render.comå‰µå»ºæ–°çš„Web Service
3. é€£æ¥GitHubå€‰åº«
4. è¨­ç½®ä»¥ä¸‹é…ç½®ï¼š
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python src/main.py`
   - **Environment**: Python 3.11

#### Heroku éƒ¨ç½²

1. å®‰è£Heroku CLI
2. å‰µå»ºHerokuæ‡‰ç”¨ï¼š`heroku create your-app-name`
3. æ¨é€ä»£ç¢¼ï¼š`git push heroku main`

#### Docker éƒ¨ç½²

å‰µå»º `Dockerfile`ï¼š
```dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
EXPOSE 5000

CMD ["python", "src/main.py"]
```

## ç’°å¢ƒè®Šæ•¸

å¯ä»¥é€šéç’°å¢ƒè®Šæ•¸é…ç½®ä»¥ä¸‹é¸é …ï¼š

- `FLASK_ENV`: è¨­ç½®ç‚º `production` ç”¨æ–¼ç”Ÿç”¢ç’°å¢ƒ
- `DATABASE_URL`: è‡ªå®šç¾©æ•¸æ“šåº«URL (å¯é¸)
- `MODEL_PATH`: è‡ªå®šç¾©æ¨¡å‹æª”æ¡ˆè·¯å¾‘ (å¯é¸)

## é–‹ç™¼èªªæ˜

### æ·»åŠ æ–°çš„APIç«¯é»

1. åœ¨ `src/routes/detection.py` ä¸­æ·»åŠ æ–°çš„è·¯ç”±å‡½æ•¸
2. ä½¿ç”¨ `@detection_bp.route()` è£é£¾å™¨å®šç¾©ç«¯é»
3. é‡å•Ÿæœå‹™å™¨æ¸¬è©¦æ–°åŠŸèƒ½

### è‡ªå®šç¾©æª¢æ¸¬é‚è¼¯

ä¿®æ”¹ `src/services/bear_detection.py` ä¸­çš„ `BearDetectionService` é¡ä¾†è‡ªå®šç¾©æª¢æ¸¬é‚è¼¯ã€‚

### æ•¸æ“šåº«é·ç§»

å¦‚éœ€ä¿®æ”¹æ•¸æ“šåº«çµæ§‹ï¼š
1. æ›´æ–° `src/models/` ä¸­çš„æ¨¡å‹å®šç¾©
2. åˆªé™¤ `src/database/app.db`
3. é‡å•Ÿæœå‹™å™¨è‡ªå‹•é‡å»ºæ•¸æ“šåº«

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **æ¨¡å‹è¼‰å…¥å¤±æ•—**
   - ç¢ºä¿ `best.pt` æª”æ¡ˆå­˜åœ¨ä¸”å¯è®€
   - æª¢æŸ¥æª”æ¡ˆè·¯å¾‘æ˜¯å¦æ­£ç¢º

2. **æ•¸æ“šåº«éŒ¯èª¤**
   - ç¢ºä¿ `src/database/` ç›®éŒ„å­˜åœ¨
   - æª¢æŸ¥æª”æ¡ˆæ¬Šé™

3. **CORSéŒ¯èª¤**
   - ç¢ºä¿å·²å®‰è£ `flask-cors`
   - æª¢æŸ¥CORSé…ç½®

### æ—¥èªŒæŸ¥çœ‹

é–‹ç™¼æ¨¡å¼ä¸‹ï¼Œè©³ç´°æ—¥èªŒæœƒé¡¯ç¤ºåœ¨æ§åˆ¶å°ã€‚ç”Ÿç”¢ç’°å¢ƒå»ºè­°é…ç½®é©ç•¶çš„æ—¥èªŒè¨˜éŒ„ã€‚

## è²¢ç»æŒ‡å—

1. Fork å°ˆæ¡ˆ
2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/new-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -am 'Add new feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/new-feature`
5. å‰µå»ºPull Request

## æˆæ¬Š

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šæ¢æ¬¾ã€‚

## è¯çµ¡è³‡è¨Š

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹é€šéä»¥ä¸‹æ–¹å¼è¯çµ¡ï¼š
- å‰µå»ºGitHub Issue
- ç™¼é€éƒµä»¶è‡³å°ˆæ¡ˆç¶­è­·è€…

---

**æ³¨æ„**: è«‹ç¢ºä¿æ‚¨æœ‰åˆæ³•æ¬Šé™ä½¿ç”¨å’Œåˆ†ç™¼YOLOæ¨¡å‹æª”æ¡ˆã€‚

